<style type="text/css">label{
    font-weight: 600;
//    display: block;
//    margin-bottom: -10px;
    color: #003262;
  }
h2 label{
     font-size:1.5rem;
//margin-bottom: -10px;
}

  input[type="text"],
  input[type="number"],
  select {
    width: 100%;
    padding: 10px;
    margin-top: 4px;
    margin-bottom: 4px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
  }

  input[type="number"] {
    width: calc(45% - 8px);
    display: inline-block;
  }

  select {
    width: calc(45% - 8px);
    display: inline-block;
    margin-left: 10px;
  }

/*  .autocomplete-wrapper {
    position: relative;
  }*/

  .autocomplete-dropdown {
    display: none;
    position: absolute;
    background-color: white;
    border: 1px solid #ccc;
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    border-radius: 6px;
  }

  .autocomplete-item {
    padding: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .autocomplete-item:hover {
    background-color: #f0f0f0;
  }

  .button {
    background-color: #CDAA00;
    color: #005B99;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    transition: transform 0.2s, background-color 0.3s;
    display: inline-block;
    text-align: center;
    font-size: 16px;
    font-weight: bold;
  }

  .button:hover {
    background-color: #005B99;
    color: #FFFFFF;
    transform: translateY(-2px);
  }

  .button:active {
    transform: translateY(2px);
  }
.time-row {
    display: flex;
flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    margin-bottom: 20px;
  }

  .time-row input[type="number"] {
  width: 60px;
  height: 35px;
  text-align: center;
  font-size: 14px;
  border-radius: 6px;
  box-sizing: border-box;
}

  .time-row select {
    width: 80px;
  }

  .time-label {
    margin-bottom: 5px;
    display: block;
    font-weight: 600;
    color: #003262;
  }

  #results {
    margin-top: 30px;
    padding: 15px;
    background: #ffffff;
    border: 1px solid #ddd;
    border-radius: 6px;
    min-height: 30px;
    color: #333;
  }

#ampm {
  height: 35px;
  width: 80px; /* Adjust as needed */
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.1;
  border-radius: 6px;
  box-sizing: border-box;
  vertical-align: middle;
}
#taskForm label {
//  display: block;
  margin-bottom: -20px; /* or smaller like 2px */
  padding: 0;
}
</style>
<div>
	<h2><label for="start">Start Location:</label></h2>

	<div class="autocomplete-wrapper"><input id="start" placeholder="Start location" type="text" />
		<div class="autocomplete-dropdown" id="start-autocomplete">&nbsp;</div>
	</div>
</div>

<h2><label for="end">End Location:</label></h2>

<div>
	<div class="autocomplete-wrapper"><input id="end" placeholder="End location" type="text" />
		<div class="autocomplete-dropdown" id="end-autocomplete">&nbsp;</div>
	</div>
</div>

<table border="0" cellpadding="1" cellspacing="1" style="width:100%; table-layout: fixed">
	<tbody style="border-top: none">
		<tr>
			<td>
				<div>
					<div>
						<h2><label class="time-label" for="hour">Time:</label></h2>
						<label><input checked="checked" name="timeMode" type="radio" value="depart" /> Depart After</label> <label><input name="timeMode" type="radio" value="arrive" /> Arrive By</label></div>

					<div class="time-row"><input id="hour" maxlength="2" placeholder="12" type="number" /> : <input id="minute" maxlength="2" placeholder="00" type="number" /> <select id="ampm"><option>AM</option><option>PM</option> </select></div>

					<div>
						<h2>&nbsp;</h2>

						<h2><label class="time-label">Schedule Type:</label></h2>
						<label><input checked="checked" name="scheduleType" type="radio" value="weekday" /> Weekday</label> <label><input name="scheduleType" type="radio" value="weekend" /> Weekend</label></div>
				</div>
			</td>
			<td>
				<div>
					<div>
						<h2><label for="routes_list">Routes Filter:</label></h2>
					</div>

					<div>
						<table border="0" cellpadding="1" cellspacing="1" style="width:100%;">
							<tbody style="border-top: none">
								<tr>
									<td>
										<form id="taskForm"><label><input name="route_name" type="checkbox" value="Bobcat Express" /> Bobcat Express</label><br />
											<label><input name="route_name" type="checkbox" value="C-1" /> C-1</label><br />
											<label><input name="route_name" type="checkbox" value="C-2" /> C-2</label><br />
											<label><input name="route_name" type="checkbox" value="G-Line" /> G-Line</label><br />
											<label><input name="route_name" type="checkbox" value="FastCat" /> FastCat</label><br />
											<label><input name="route_name" type="checkbox" value="FastCat 2" /> FastCat 2</label><br />
											<label><input name="route_name" type="checkbox" value="Yosemite Express" /> Yosemite Express</label><br />
											<label><input name="route_name" type="checkbox" value="E-1" /> E-1</label><br />
											<label><input name="route_name" type="checkbox" value="E-2" /> E-2</label><br />
											<label><input name="route_name" type="checkbox" value="Route UC (North Loop)" /> Route UC (North Loop)</label><br />
											<label><input name="route_name" type="checkbox" value="Route UC (South Loop)" /> Route UC (South Loop)</label></form>
									</td>
									<td>
										<p><button onclick="selectAll()">Select All</button></p>

										<p>&nbsp;</p>

										<p><button onclick="deselectAll()">Deselect All</button></p>

										<p>&nbsp;</p>

										<p><button onclick="summerRoutes()">Summer Routes</button></p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</td>
		</tr>
	</tbody>
</table>

<h2 style="text-align: center;"><button class="button" onclick="planTrip()">Plan Trip</button></h2>

<div id="results">&nbsp;</div>

<p style="text-align: center;">&nbsp;</p>

<p style="text-align: center;">&nbsp;</p>

<p style="text-align: center;">&nbsp;</p>

<p style="text-align: center; font-size: 12px"><b>This program is intended to be used as a helpful tool rather than a complete replacement of using the provided schedules in the routes page. Please use the route schedules for every bus line provided&nbsp;<a href="https://taps.ucmerced.edu/transportation/cattracks-and-route-uc/routes">here</a>&nbsp;to verify the bus times given by this program. If you ever find any issues or&nbsp;inaccuracies presented by this&nbsp;program, please send an email, preferably with screenshots and steps to recreate it, to <a href="mailto:jnardello@ucmerced.edu?subject=CatTracks%20Trip%20Planner%20Issue">jnardello@ucmerced.edu</a>.</b></p>
<script>
    const routesData = [
      {
        route: "Bobcat Express",
        weekday: [
          { stop: "R Street Village Apartments", times: ["06:29", "07:09", "07:49", "08:44", "09:24", "10:04", "10:44", "12:09", "13:49", "15:17", "16:57", "18:22", "20:02"] },
          { stop: "El Redondo Drive (Jenner Drive)", times: ["06:32", "07:12", "07:52", "08:47", "09:27", "10:07", "10:47", "12:12", "13:52", "15:20", "17:00", "18:25", "20:05"] },
          { stop: "Compass Pointe Apartments (Pacific Drive)", times: ["06:34", "07:14", "07:54", "08:49", "09:29", "10:09", "10:49", "12:14", "13:54", "15:22", "17:02", "18:27", "20:07"] },
          { stop: "Merced College The Bus Terminal", times: ["06:39", "07:19", "07:59", "08:54", "09:34", "10:14", "10:54", "12:19", "13:59", "15:27", "17:07", "18:32", "20:12"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["06:44", "07:24", "08:04", "08:59", "09:39", "10:19", "11:00", "12:25", "14:05", "15:33", "17:13", "18:38", "20:18"] },
          { stop: "University Transit Center (UTC)", times: ["06:55", "07:35", "08:30", "09:10", "09:50", "10:30", "11:11", "12:51", "14:16", "15:59", "17:24", "19:04", "20:29"] },
          { stop: "Promenade Center", times: ["11:20", "13:00", "14:25", "16:08", "17:33", "19:13"] },
          { stop: "Merced Mall / Target", times: ["11:29", "13:09", "14:37", "16:17", "17:42", "19:22"] },
          { stop: "Walmart (Loughborough Drive)", times: ["11:38", "13:18", "14:46", "16:26", "17:51", "19:31"] },
          { stop: "Amtrak Train Station", times: ["11:50", "13:30", "14:58", "16:38", "18:03", "19:43", "21:20"] },
          { stop: "K Street Between 18th Street & 19th Street", times: ["11:52", "13:32", "15:00", "16:40", "18:05", "19:45"] },
          { stop: "Merced Transpo", times: ["12:01", "13:41", "15:09", "16:49", "18:14", "19:54"] },  // REQ filled with Rite Aid/Walgreens time
          { stop: "Rite Aid/Walgreens (G Street)", times: ["12:02", "13:42", "15:10", "16:50", "18:15", "19:55"] },
          { stop: "El Portal Plaza (G Street)", times: ["12:03", "13:43", "15:11", "16:51", "18:16", "19:56"] },
          { stop: "R Street Village Apartments", times: ["12:09", "13:49", "15:17", "16:57", "18:22", "20:02"] }
        ]
      },
      {
        route: "C-1",
        weekday: [
          { stop: "Granville Apartments", times: ["06:20", "07:31", "08:57", "10:08", "11:34", "12:45", "14:16", "15:27", "16:53", "18:04", "19:15", "20:41", "21:52"] },
          { stop: "G Street & West Alexander Avenue", times: ["06:32", "07:43", "09:09", "10:20", "11:46", "12:57", "14:28", "15:39", "17:05", "18:16", "19:27", "20:53", "22:04"] },
          { stop: "Rite Aid/Walgreens (G Street)", times: ["06:34", "07:45", "09:11", "10:22", "11:48", "12:59", "14:30", "15:41", "17:07", "18:18", "19:29", "20:55", "22:06"] },
          { stop: "El Portal Plaza (G Street)", times: ["06:36", "07:47", "09:13", "10:24", "11:50", "13:01", "14:32", "15:43", "17:09", "18:20", "19:31", "20:57", "22:08"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["06:39", "07:50", "09:16", "10:27", "11:53", "13:04", "14:35", "15:46", "17:12", "18:23", "19:34", "21:00", "22:11"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["06:45", "07:56", "09:22", "10:33", "11:59", "13:10", "14:41", "15:52", "17:18", "18:29", "19:40", "21:06", "22:17"] },
          { stop: "University Transit Center (UTC)", times: ["06:56", "08:22", "09:33", "10:59", "12:10", "13:36", "14:52", "16:18", "17:29", "18:40", "20:06", "21:17", "22:28"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["07:06", "08:32", "09:43", "11:09", "12:20", "13:46", "15:02", "16:28", "17:39", "18:50", "20:16", "21:27", "21:27"] },
          { stop: "El Portal Plaza (G Street)", times: ["07:09", "08:35", "09:46", "11:12", "12:23", "13:49", "15:05", "16:31", "17:42", "18:53", "20:19", "21:30", "21:30"] },
          { stop: "G Street & West Alexander Avenue", times: ["07:14", "08:40", "09:51", "11:17", "12:28", "13:54", "15:10", "16:36", "17:47", "18:58", "20:24", "21:35", "21:35"] },
          { stop: "Granville Apartments", times: ["07:31", "08:57", "10:08", "11:34", "12:45", "14:16", "15:27", "16:53", "18:04", "19:15", "20:41", "21:52", "21:52"] }
        ]
      },
      {
        route: "C-2",
        weekday: [
          { stop: 'R Street Village Apartments', times: ["06:20", "07:18", "08:31", "09:29", "10:42", "11:40", "12:53", "13:51", "14:52", "15:50", "17:03", "18:01", "19:14", "20:12", "21:25"] },
          { stop: "El Redondo Drive (Jenner Drive)", times: ["06:23", "07:21", "08:34", "09:32", "10:45", "11:43", "12:56", "13:54", "14:55", "15:53", "17:06", "18:04", "19:17", "20:15", "21:28"] },
          { stop: "Compass Pointe Apartments (Pacific Drive)", times: ["06:25", "07:23", "08:36", "09:34", "10:47", "11:45", "12:58", "13:56", "14:57", "15:55", "17:08", "18:06", "19:19", "20:17", "21:30"] },
          { stop: "Buena Vista Drive", times: ["06:32", "07:30", "08:43", "09:41", "10:54", "11:52", "13:05", "14:03", "15:04", "16:02", "17:15", "18:13", "19:26", "20:24", "21:37"] },
          { stop: "Merced Mall / Target", times: ["06:39", "07:37", "08:50", "09:48", "11:01", "11:59", "13:12", "14:13", "15:11", "16:09", "17:22", "18:20", "19:33", "20:31", "21:44"] },
          { stop: 'M Street Village Apartments', times: ["06:41", "07:39", "08:52", "09:50", "11:03", "12:01", "13:14", "14:15", "15:13", "16:11", "17:24", "18:22", "19:35", "20:33", "21:46"] },
          { stop: "Merced College The Bus Terminal", times: ["06:45", "07:43", "08:56", "09:54", "11:07", "12:05", "13:18", "14:19", "15:17", "16:15", "17:28", "18:26", "19:39", "20:37", "21:50"] },
          { stop: 'Cardella Road & M Street', times: ["06:48", "07:46", "08:59", "09:57", "11:10", "12:08", "13:21", "14:22", "15:20", "16:18", "17:31", "18:29", "19:42", "20:40", "21:53"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["06:51", "07:49", "09:02", "10:00", "11:13", "12:11", "13:24", "14:25", "15:23", "16:21", "17:34", "18:32", "19:45", "20:43", "21:56"] },
          { stop: "University Transit Center (UTC)", times: ["07:02", "08:15", "09:13", "10:26", "11:24", "12:37", "13:35", "14:36", "15:34", "16:47", "17:45", "18:58", "19:56", "21:09", "22:07"] },
          { stop: "Foothill Drive", times: ["07:09", "08:22", "09:20", "10:33", "11:31", "12:44", "13:42", "14:43", "15:41", "16:54", "17:52", "19:05", "20:03", "21:16", "21:16"] },
          { stop: 'Cardella Road & M Street', times: ["07:13", "08:26", "09:24", "10:37", "11:35", "12:48", "13:46", "14:47", "15:45", "16:58", "17:56", "19:09", "20:07", "21:20", "21:20"] },
          { stop: 'R Street Village Apartments', times: ["07:18", "08:31", "09:29", "10:42", "11:40", "12:53", "13:51", "14:52", "15:50", "17:03", "18:01", "19:14", "20:12", "21:25", "21:25"] }
        ]
      },
      {
        route: "G-Line",
        weekday: [
          { stop: 'R Street Village Apartments', times: ["06:30", "07:38", "09:01", "10:09", "11:17", "12:25", "13:48", "15:01", "16:09", "17:32", "18:40", "19:48", "21:11"] },
          { stop: "El Redondo Drive (Jenner Drive)", times: ["06:33", "07:41", "09:04", "10:12", "11:20", "12:28", "13:51", "15:04", "16:12", "17:35", "18:43", "19:51", "21:14"] },
          { stop: "Compass Pointe Apartments (Pacific Drive)", times: ["06:35", "07:43", "09:06", "10:14", "11:22", "12:30", "13:53", "15:06", "16:14", "17:37", "18:45", "19:53", "21:16"] },
          { stop: "Merced College The Bus Terminal", times: ["06:40", "07:48", "09:11", "10:19", "11:27", "12:35", "13:58", "15:11", "16:19", "17:42", "18:50", "19:58", "21:21"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["06:46", "07:54", "09:17", "10:25", "11:33", "12:41", "14:04", "15:17", "16:25", "17:48", "18:56", "20:04", "21:27"] },
          { stop: "University Transit Center (UTC)", times: ["06:57", "08:20", "09:28", "10:36", "11:44", "13:07", "14:15", "15:28", "16:51", "17:59", "19:07", "20:30", "21:38"] },
          { stop: "Amtrak Train Station", times: ["07:18", "08:41", "09:49", "10:57", "12:05", "13:28", "14:36", "15:49", "17:12", "18:20", "19:28", "20:51", "21:59"] },
          { stop: "K Street Between 18th Street & 19th Street", times: ["07:20", "08:43", "09:51", "10:59", "12:07", "13:30", "14:43", "15:51", "17:14", "18:22", "19:30", "20:53", "22:01"] },
          { stop: "UC Merced Downtown Campus Center", times: ["07:22", "08:45", "09:53", "11:01", "12:09", "13:32", "14:45", "15:53", "17:16", "18:24", "19:32", "20:55", "22:03"] },
          { stop: "Merced Transpo", times: ["07:22", "08:45", "09:53", "11:01", "12:09", "13:32", "14:45", "15:53", "17:16", "18:24", "19:32", "20:55", "22:03"] },
          { stop: 'R Street Village Apartments', times: ["07:38", "09:01", "10:09", "11:17", "12:25", "13:48", "15:01", "16:09", "17:32", "18:40", "19:48", "21:11"] }

        ]
      },
      {
        route: "FastCat",
        weekday: [
          { stop: "University Surgery Center", times: ["06:35", "07:39", "08:58", "10:02", "11:06", "12:25", "13:29", "14:36", "15:40", "16:59", "18:03", "19:07", "20:11", "21:30"] },
          { stop: "Promenade Center", times: ["06:39", "07:43", "09:02", "10:06", "11:10", "12:29", "13:33", "14:40", "15:44", "17:03", "18:07", "19:11", "20:15", "21:34"] },
          { stop: "Yosemite Crossings Shopping Center", times: ["06:42", "07:46", "09:05", "10:09", "11:13", "12:32", "13:36", "14:43", "15:47", "17:06", "18:10", "19:14", "20:18", "21:37"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["06:44", "07:48", "09:07", "10:11", "11:15", "12:34", "13:38", "14:45", "15:49", "17:08", "18:12", "19:16", "20:20", "21:39"] },
          { stop: 'Cardella Road & M Street', times: ["06:48", "07:52", "09:11", "10:15", "11:19", "12:38", "13:42", "14:49", "15:53", "17:12", "18:16", "19:20", "20:24", "21:43"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["06:52", "07:56", "09:15", "10:19", "11:23", "12:42", "13:46", "14:53", "15:57", "17:16", "18:20", "19:24", "20:28", "21:47"] },
          { stop: "University Transit Center (UTC)", times: ["07:03", "08:22", "09:26", "10:30", "11:34", "12:53", "13:57", "15:04", "16:23", "17:27", "18:31", "19:35", "20:54", "21:58"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["07:13", "08:32", "09:36", "10:40", "11:44", "13:03", "14:07", "15:14", "16:33", "17:37", "18:41", "19:45", "21:04", "22:08"] },
          { stop: "Yosemite & Cordova (Merced Physician Center)", times: ["07:16", "08:35", "09:39", "10:43", "11:47", "13:06", "14:10", "15:17", "16:36", "17:40", "18:44", "19:48", "21:07", "22:11"] },
          { stop: "University Surgery Center", times: ["07:19", "08:38", "09:42", "10:46", "11:50", "13:09", "14:13", "15:20", "16:39", "17:43", "18:47", "19:51", "21:10", "22:14"] },
          { stop: "Moraga Subdivision", times: ["07:22", "08:41", "09:45", "10:49", "11:53", "13:12", "14:19", "15:23", "16:42", "17:46", "18:50", "19:54", "21:13", "22:17"] },
          { stop: "University Transit Center (UTC)", times: ["07:30", "08:49", "09:53", "10:57", "12:16", "13:20", "14:27", "15:31", "16:50", "17:54", "18:58", "20:02", "21:21", "22:25"] },
          { stop: "University Surgery Center", times: ["07:39", "08:58", "10:02", "11:06", "12:25", "13:29", "14:36", "15:40", "16:59", "18:03", "19:07", "20:11", "21:30"] }
        ]
      },
      {
        route: "FastCat 2",
        weekday: [
          { stop: "University Surgery Center", times: ["08:30", "09:34", "10:53", "11:57", "13:01", "14:20", "15:24", "16:31", "17:50", "18:54", "20:13", "21:17"] },
          { stop: "Promenade Center", times: ["08:34", "09:38", "10:57", "12:01", "13:05", "14:24", "15:28", "16:35", "17:54", "18:58", "20:17", "21:21"] },
          { stop: "Yosemite Crossings Shopping Center", times: ["08:37", "09:41", "11:00", "12:04", "13:08", "14:27", "15:31", "16:38", "17:57", "19:01", "20:20", "21:24"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["08:39", "09:43", "11:02", "12:06", "13:10", "14:29", "15:33", "16:40", "17:59", "19:03", "20:22", "21:26"] },
          { stop: 'Cardella Road & M Street', times: ["08:43", "09:47", "11:06", "12:10", "13:14", "14:33", "15:37", "16:44", "18:03", "19:07", "20:26", "21:30"] },
          { stop: "M Street & Bellevue Road (Bellevue Ranch)", times: ["08:47", "09:51", "11:10", "12:14", "13:18", "14:37", "15:41", "16:48", "18:07", "19:11", "20:30", "21:34"] },
          { stop: "University Transit Center (UTC)", times: ["08:58", "10:17", "11:21", "12:25", "13:29", "14:48", "15:52", "16:59", "18:18", "19:22", "20:41", "21:45"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["09:08", "10:27", "11:31", "12:35", "13:39", "14:58", "16:02", "17:09", "18:28", "19:32", "20:51", "20:51"] },
          { stop: "Yosemite & Cordova (Merced Physician Center)", times: ["09:11", "10:30", "11:34", "12:38", "13:42", "15:01", "16:05", "17:12", "18:31", "19:35", "20:54", "20:54"] },
          { stop: "University Surgery Center", times: ["09:14", "10:33", "11:37", "12:41", "13:45", "15:04", "16:08", "17:15", "18:34", "19:38", "20:57", "20:57"] },
          { stop: "Moraga Subdivision", times: ["09:17", "10:36", "11:40", "12:44", "13:48", "15:07", "16:11", "17:18", "18:37", "19:41", "21:00", "21:00"] },
          { stop: "University Transit Center (UTC)", times: ["09:25", "10:44", "11:48", "12:52", "14:11", "15:15", "16:22", "17:41", "18:45", "20:04", "21:08", "21:08"] },
          { stop: "University Surgery Center", times: ["09:34", "10:53", "11:57", "13:01", "14:20", "15:24", "16:31", "17:50", "18:54", "20:13", "21:17", "21:17"] }
        ]
      },
      {
        route: "Yosemite Express",
        weekday: [
          { stop: "Moraga Subdivision", times: ["09:00", "09:27", "09:54", "10:36", "11:03", "11:30", "11:57", "12:24", "12:51", "13:18", "14:00", "14:27", "14:54", "15:21", "16:03", "16:35", "17:02", "17:29", "17:56", "18:38", "19:05", "19:32", "19:59", "20:26", "20:53", "21:20", "22:02"] },
          { stop: "University Transit Center (UTC)", times: ["09:07", "09:34", "10:16", "10:43", "11:10", "11:37", "12:04", "12:31", "12:58", "13:40", "14:07", "14:34", "15:01", "15:43", "16:10", "16:42", "17:09", "17:36", "18:18", "18:45", "19:12", "19:39", "20:06", "20:33", "21:00", "21:42", "22:09"] },
          { stop: "Foothill Drive", times: ["09:16", "09:43", "10:25", "10:52", "11:19", "11:46", "12:13", "12:40", "13:07", "13:49", "14:16", "14:43", "15:10", "15:52", "16:24", "16:51", "17:18", "17:45", "18:27", "18:54", "19:21", "19:48", "20:15", "20:42", "21:09", "21:51", "21:51"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["09:16", "09:43", "10:25", "10:52", "11:19", "11:46", "12:13", "12:40", "13:07", "13:49", "14:16", "14:43", "15:10", "15:52", "16:24", "16:51", "17:18", "17:45", "18:27", "18:54", "19:21", "19:48", "20:15", "20:42", "21:09", "21:51", "21:51"] },
          { stop: "Raley's (G Street)", times: ["09:19", "09:46", "10:28", "10:55", "11:22", "11:49", "12:16", "12:43", "13:10", "13:52", "14:19", "14:46", "15:13", "15:55", "16:27", "16:54", "17:21", "17:48", "18:30", "18:57", "19:24", "19:51", "20:18", "20:45", "21:12", "19:54", "19:54"] },
          { stop: "University Surgery Center", times: ["09:24", "09:51", "10:33", "11:00", "11:27", "11:54", "12:21", "12:48", "13:15", "13:57", "14:24", "14:51", "15:18", "16:00", "16:32", "16:59", "17:26", "17:53", "18:35", "19:02", "19:29", "19:56", "20:23", "20:50", "21:17", "21:59", "21:59"] },
          { stop: "Moraga Subdivision", times: ["09:27", "09:54", "10:36", "11:03", "11:30", "11:57", "12:24", "12:51", "13:18", "14:00", "14:27", "14:54", "15:21", "16:03", "16:35", "17:02", "17:29", "17:56", "18:38", "19:05", "19:32", "19:59", "20:26", "20:53", "21:20", "22:02", "22:02"] }
        ]
      },
      {
        route: "E-1",
        weekend: [
          { stop: "University Transit Center (UTC)", times: ["08:30", "09:42", "10:39", "11:51", "12:48", "14:00", "14:57", "15:54", "16:54", "18:06", "19:03", "20:00", "21:12", "22:09", "23:06"] },
          { stop: "Raley's (G Street)", times: ["08:39", "09:51", "10:48", "12:00", "12:57", "14:09", "15:06", "16:03", "17:03", "18:15", "19:12", "20:09", "21:21", "22:18"] },
          { stop: "Amtrak Train Station", times: ["08:46", "09:58", "10:55", "12:07", "13:04", "14:16", "15:13", "16:10", "17:10", "18:22", "19:19", "20:16", "21:28", "22:25"] },
          { stop: "K Street Between 18th Street & 19th Street", times: ["08:48", "10:00", "10:57", "12:09", "13:06", "14:18", "15:15", "16:15", "17:12", "18:24", "19:21", "20:18", "21:30", "22:27"] },
          { stop: "Walmart (Loughborough Drive)", times: ["09:01", "10:13", "11:10", "12:22", "13:19", "14:31", "15:28", "16:28", "17:25", "18:37", "19:34", "20:31", "21:43", "22:40"] },
          { stop: "Meadows Avenue & Olivewood Drive (Foodmaxx)", times: ["09:03", "10:15", "11:12", "12:24", "13:21", "14:33", "15:30", "16:30", "17:27", "18:39", "19:36", "20:33", "21:45", "22:42"] },
          { stop: "Merced Mall / Target", times: ["09:07", "10:19", "11:16", "12:28", "13:25", "14:37", "15:34", "16:34", "17:31", "18:43", "19:40", "20:37", "21:49", "22:46"] },
          { stop: "Rite Aid/Walgreens (G Street)", times: ["09:14", "10:26", "11:23", "12:35", "13:32", "14:44", "15:41", "16:41", "17:38", "18:50", "19:47", "20:44", "21:56", "22:53"] },
          { stop: "Yosemite Crossings Shopping Center", times: ["09:18", "10:30", "11:27", "12:39", "13:36", "14:48", "15:45", "16:45", "17:42", "18:54", "19:51", "20:48", "22:00", "22:57"] }
        ]
      },
      {
        route: "E-2",
        weekend: [
          { stop: "University Transit Center (UTC)", times: ["11:05", "12:09", "12:58", "13:47", "14:36", "15:40", "16:29", "17:18", "18:25", "19:14", "20:18", "21:07", "21:56"] },
          { stop: "Promenade Center", times: ["11:14", "12:18", "13:07", "13:56", "14:45", "15:49", "16:38", "17:27", "18:34", "19:23", "20:27", "21:16"] },
          { stop: "R Street Village Apartments", times: ["11:20", "12:24", "13:13", "14:02", "14:51", "15:55", "16:44", "17:36", "18:40", "19:29", "20:33", "21:22"] },
          { stop: "El Redondo Drive (Jenner Drive)", times: ["11:23", "12:27", "13:16", "14:05", "14:54", "15:58", "16:47", "17:39", "18:43", "19:32", "20:36", "21:25"] },
          { stop: "Compass Pointe Apartments (Pacific Drive)", times: ["11:25", "12:29", "13:18", "14:07", "14:56", "16:00", "16:49", "17:41", "18:45", "19:34", "20:38", "21:27"] },
          { stop: "Merced Mall / Target", times: ["11:31", "12:35", "13:24", "14:13", "15:02", "16:06", "16:55", "17:47", "18:51", "19:40", "20:44", "21:33"] },
          { stop: "M Street Village Apartments", times: ["11:33", "12:37", "13:26", "14:15", "15:04", "16:08", "16:57", "17:49", "18:53", "19:42", "20:46", "21:35"] },
          { stop: "Ironstone Drive & M Street", times: ["11:37", "12:41", "13:30", "14:19", "15:08", "16:12", "17:01", "17:53", "18:57", "19:46", "20:50", "21:39"] },
          { stop: "Yosemite & Cordova (Merced Physician Center)", times: ["11:43", "12:47", "13:36", "14:25", "15:14", "16:18", "17:07", "17:59", "19:03", "19:52", "20:56", "21:45"] },
          { stop: "Moraga Subdivision", times: ["11:46", "12:50", "13:39", "14:28", "15:17", "16:21", "17:10", "18:02", "19:06", "19:55", "20:59", "21:48"] }
        ]
      },
      
      {
        route: "Route UC (North Loop)",
        weekday: [
          { stop: "University Transit Center (UTC)", times: ["6:47", "7:27", "8:07", "8:47", "9:27", "10:07", "10:47", "11:27", "12:07", "12:47", "13:27", "14:07", "14:47", "15:27", "16:07", "16:47", "17:27", "18:07", "18:47", "19:27"] },
          { stop: "Paulson Ave & Yosemite Ave (Opposite of Promenade)", times: ["6:57", "7:37", "8:17", "8:57", "9:37", "10:17", "10:57", "11:37", "12:17", "12:57", "13:37", "14:17", "14:57", "15:37", "16:17", "16:57", "17:37", "18:17", "18:57", "19:37"] },
          { stop: "Tri-College / Mercy Hospital (G Street)", times: ["7:04", "7:44", "8:24", "9:04", "9:44", "10:24", "11:04", "11:44", "12:24", "13:04", "13:44", "14:24", "15:04", "15:44", "16:24", "17:04", "17:44", "18:24", "19:04", "19:44"] },
          { stop: "Merced College The Bus Terminal", times: ["7:06", "7:46", "8:26", "9:06", "9:46", "10:26", "11:06", "11:46", "12:26", "13:06", "13:46", "14:26", "15:06", "15:46", "16:26", "17:06", "17:46", "18:26", "19:06", "19:46"] },
          { stop: "M Street & Olive Avenue", times: ["7:11", "7:51", "8:31", "9:11", "9:51", "10:31", "11:11", "11:51", "12:31", "13:11", "13:51", "14:31", "15:11", "15:51", "16:31", "17:11", "17:51", "18:31", "19:11", "19:51"] },
          { stop: "Amtrak Train Station", times: ["7:16", "7:56", "8:36", "9:16", "9:56", "10:36", "11:16", "11:56", "12:36", "13:16", "13:56", "14:36", "15:16", "15:56", "16:36", "17:16", "17:56", "18:36", "19:16", "19:56"] },
          { stop: "Merced Transpo", times: ["7:21", "8:01", "8:41", "9:21", "10:01", "10:41", "11:21", "12:01", "12:41", "13:21", "14:01", "14:41", "15:21", "16:01", "16:41", "17:21", "18:01", "18:41", "19:21", "20:01"] }
        ]
      },
      {
        route: "Route UC (South Loop)",
        weekday: [
          {stop:"Merced Transpo",times:["06:10","06:50","07:30","08:10","08:50","09:30","10:10","10:50","11:30","12:10","12:50","13:30","14:10","14:50","15:30","16:10","16:50","17:30","18:10","18:50","19:30"]},
          {stop:"The Bus MCAG Office",times:["06:13","06:53","07:33","08:13","08:53","09:33","10:13","10:53","11:33","12:13","12:53","13:33","14:13","14:53","15:33","16:13","16:53","17:33","18:13","18:53","19:33"]},
          {stop:"Amtrak Train Station",times:["06:15","06:55","07:35","08:15","08:55","09:35","10:15","10:55","11:35","12:15","12:55","13:35","14:15","14:55","15:35","16:15","16:55","17:35","18:15","18:55","19:35"]},
          {stop:"M Street & Olive Avenue",times:["06:20","07:00","07:40","08:20","09:00","09:40","10:20","11:00","11:40","12:20","13:00","13:40","14:20","15:00","15:40","16:20","17:00","17:40","18:20","19:00","19:40"]},
          {stop:"Merced College The Bus Terminal",times:["06:25","07:05","07:45","08:25","09:05","09:45","10:25","11:05","11:45","12:25","13:05","13:45","14:25","15:05","15:45","16:25","17:05","17:45","18:25","19:05","19:45"]},
          {stop:"Merced College UC Parking",times:["06:26","07:06","07:46","08:26","09:06","09:46","10:26","11:06","11:46","12:26","13:06","13:46","14:26","15:06","15:46","16:26","17:06","17:46","18:26","19:06","19:46"]},
          {stop:"Paulson Ave & Yosemite Ave (Opposite of Promenade)",times:["06:33","07:13","07:53","08:33","09:13","09:53","10:33","11:13","11:53","12:33","13:13","13:53","14:33","15:13","15:53","16:33","17:13","17:53","18:33","19:13","19:53"]},
          {stop:"University Transit Center (UTC)",times:["06:42","07:22","08:02","08:42","09:22","10:02","10:42","11:22","12:02","12:42","13:22","14:02","14:42","15:22","16:02","16:42","17:22","18:02","18:42","19:22","20:02"]}
        ]
      }
    ];

// ------------------- Priority Queue -------------------
class MinHeap {
  constructor() {
    this.heap = [];
  }

  push(node) {
    this.heap.push(node);
    this._bubbleUp();
  }

  pop() {
    if (this.heap.length <= 1) return this.heap.pop();
    const top = this.heap[0];
    this.heap[0] = this.heap.pop();
    this._sinkDown();
    return top;
  }

  isEmpty() {
    return this.heap.length === 0;
  }

  _bubbleUp() {
    let i = this.heap.length - 1;
    while (i > 0) {
      const parent = Math.floor((i - 1) / 2);
      if (this.heap[i].arrivalTime >= this.heap[parent].arrivalTime) break;
      [this.heap[i], this.heap[parent]] = [this.heap[parent], this.heap[i]];
      i = parent;
    }
  }

  _sinkDown() {
    let i = 0;
    const len = this.heap.length;
    while (true) {
      let left = 2 * i + 1, right = 2 * i + 2, smallest = i;
      if (left < len && this.heap[left].arrivalTime < this.heap[smallest].arrivalTime) smallest = left;
      if (right < len && this.heap[right].arrivalTime < this.heap[smallest].arrivalTime) smallest = right;
      if (smallest === i) break;
      [this.heap[i], this.heap[smallest]] = [this.heap[smallest], this.heap[i]];
      i = smallest;
    }
  }
}

function clampInputValue(inputId, min, max) {
  const input = document.getElementById(inputId);
  if (!input) {
    console.warn(`Input element with id "${inputId}" not found.`);
    return;
  }

  input.addEventListener("blur", () => {
    let value = parseInt(input.value);
    if (isNaN(value)) return;
    if (value < min) value = min;
    if (value > max) value = max;
    input.value = value.toString().padStart(2, "0");
  });
}

// ------------------- Time Helpers -------------------
function timeToMinutes(str) {
  const [h, m] = str.split(":").map(Number);
  return h * 60 + m;
}

function to12Hour(timeStr) {
  let [h, m] = timeStr.split(":").map(Number);
  const ampm = h >= 12 ? "PM" : "AM";
  h = h % 12 || 12;
  return `${h}:${m.toString().padStart(2, "0")} ${ampm}`;
}

function getStartTimeInMinutes() {
  let hour = parseInt(document.getElementById("hour").value, 10) || 0;
  let minute = parseInt(document.getElementById("minute").value, 10) || 0;
  const ampm = document.getElementById("ampm").value;
  if (ampm === "PM" && hour !== 12) hour += 12;
  if (ampm === "AM" && hour === 12) hour = 0;
  return hour * 60 + minute;
}


// ------------------- Graph Construction -------------------
let graph = { weekday: {}, weekend: {} };
routesData.forEach(({ route, weekday, weekend }) => {
  if (weekday) addRouteToGraph(graph.weekday, route, weekday);
  if (weekend) addRouteToGraph(graph.weekend, route, weekend);
});

function addRouteToGraph(graphPart, route, stops) {
  for (let i = 0; i < stops.length - 1; i++) {
    const from = stops[i];
    const to = stops[i + 1];

    if (!graphPart[from.stop]) graphPart[from.stop] = [];
    if (!graphPart[to.stop]) graphPart[to.stop] = [];

    const pairCount = Math.min(from.times.length, to.times.length);

    for (let j = 0; j < pairCount; j++) {
      const departTime = from.times[j];
      const arriveTime = to.times[j];

      if (!departTime || !arriveTime) continue; // defensive check

      graphPart[from.stop].push({
        to: to.stop,
        route,
        departTime,
        arriveTime
      });

      graphPart[to.stop].push({
        to: from.stop,
        route,
        departTime: arriveTime,
        arriveTime: departTime
      });
    }
  }
}

// ------------------- Dijkstra-like Route Finder -------------------

function findArrivalTimeOptimizedRoute(graphPart, start, end, timeMinutes, mode = "depart") {
  return mode === "arrive"
    ? findRouteArriveBy(graphPart, start, end, timeMinutes)
    : findRouteDepartAfter(graphPart, start, end, timeMinutes);
}

function findRouteArriveBy(graphPart, start, end, endMinutes) {
  const queue = [{
    stop: end,
    time: endMinutes,
    path: [],
    bus_changes: 0
  }];

  const visited = new Map(); // key: stop, value: latest time visited
  let bestPaths = [];
  let totalPaths = 0;

  while (queue.length > 0) {
    // Prioritize later arrival time and fewer bus changes
    queue.sort((a, b) => b.time - a.time || a.bus_changes - b.bus_changes);
    const current = queue.shift();

    const prevTime = visited.get(current.stop);
    if (prevTime !== undefined && prevTime >= current.time) continue;
    visited.set(current.stop, current.time);

    if (current.stop === start) {
      bestPaths[totalPaths++] = current.path;
      continue;
    }

    for (const fromStop in graphPart) {
      for (const edge of graphPart[fromStop]) {
        if (edge.to !== current.stop) continue;

        const depart = timeToMinutes(edge.departTime);
        const arrive = timeToMinutes(edge.arriveTime);

        // Only consider edges that arrive before current time
        if (arrive > current.time || arrive < depart) continue;

        queue.push({
          stop: fromStop,
          time: depart,
          path: [{
            from: fromStop,
            to: current.stop,
            route: edge.route,
            departTime: edge.departTime,
            arriveTime: edge.arriveTime
          }, ...current.path],
          bus_changes:
            current.path.length > 0 &&
            edge.route !== current.path[0].route
              ? current.bus_changes + 1
              : current.bus_changes
        });
      }
    }
  }

  bestPaths.sort((a, b) => timeToMinutes(a.at(-1).arriveTime) - timeToMinutes(b.at(-1).arriveTime));
  console.log(bestPaths);
  return bestPaths[0] || null;
}

function findRouteDepartAfter(graphPart, start, end, startMinutes) {
  const queue = [{
    stop: start,
    time: startMinutes,
    path: []
  }];

  const visited = new Map(); // key: stop, value: earliest time visited
  let bestPaths = [];
  let totalPaths = 0;

  while (queue.length > 0) {
    queue.sort((a, b) => b.time - a.time || a.bus_changes - b.bus_changes);
    const current = queue.shift();
    const prevTime = visited.get(current.stop);
    if (prevTime !== undefined && prevTime <= current.time) continue;
    visited.set(current.stop, current.time);

    if (current.stop === end) {
      bestPaths[totalPaths++] = current.path;
      continue;
    }

    const neighbors = graphPart[current.stop] || [];
    console.log(neighbors);
    for (const edge of neighbors) {
      const depart = timeToMinutes(edge.departTime);
      const arrive = timeToMinutes(edge.arriveTime);

      // Invalid edge if depart < current time or arrive < depart
      if (
        (current.path.length === 0 && depart < startMinutes) ||
        arrive < depart ||
        depart < current.time
      ) {
        continue;
      }

      queue.push({
        stop: edge.to,
        time: arrive,
        path: [
          ...current.path,
          {
            from: current.stop,
            to: edge.to,
            route: edge.route,
            departTime: edge.departTime,
            arriveTime: edge.arriveTime
          }
        ]
      });
    }
  }
//  console.log(bestPaths[0][0]);
//  console.log(bestPaths[0][0].arriveTime);
  bestPaths.sort((a, b) => timeToMinutes(a.at(-1).arriveTime) - timeToMinutes(b.at(-1).arriveTime));
  
//  console.log(bestPaths);
  return bestPaths[0] || null;
}







// ------------------- Plan Trip Logic -------------------
function planTrip() {
  const start = document.getElementById("start").value.trim();
  const end = document.getElementById("end").value.trim();
  const scheduleType = document.querySelector('input[name="scheduleType"]:checked')?.value || "weekday";
  const startMinutes = getStartTimeInMinutes();
  const output = document.getElementById("results");
  const checklist = document.querySelectorAll('input[name="route_name"]:checked');
  let list = [];

  checklist.forEach((checkbox) => {
    list.push(checkbox.value);
  });
  //console.log(list)

  graph = { weekday: {}, weekend: {} };
  routesData.forEach(({ route, weekday, weekend }) => {
//  console.log(route);
    if (weekday && list.includes(route)) addRouteToGraph(graph.weekday, route, weekday);
    if (weekend && list.includes(route)) addRouteToGraph(graph.weekend, route, weekend);
  });
  //console.log(graph)
  output.innerHTML = "";

  if (!start || !end) {
    output.textContent = "Please enter both start and end locations.";
    return;
  }

  const graphPart = graph[scheduleType];
  const timeMode = document.querySelector('input[name="timeMode"]:checked')?.value || "depart";
  const path = findArrivalTimeOptimizedRoute(graphPart, start, end, startMinutes, timeMode);



  if (!path || path.length === 0) {
    output.textContent = "No route found between these locations at this time.";
    return;
  }
//  displayGroupedTrip(path, start, end, output);

  output.innerHTML = `<strong>Trip from "${start}" to "${end}":</strong><br><br>`;
  var repeated_bus_line = false;
  var current_line = "";
  var last_stop = "";
  var upcoming_stop = "";
  var lastDepartTime = "";
  var lastArriveTime = "";
  var j = 1;
//  console.log(path);
  if(timeMode){
    path.forEach((step, i) => {
      if(i == 0){
        current_line = step.route;
        last_stop = step.from;
        upcoming_stop = step.to;
        lastDepartTime = step.departTime;
        lastArriveTime = step.arriveTime;
        if(path.length == 1){
            output.innerHTML += `
          ${j}. Take <strong>${step.route}</strong> from "<em>${step.from}</em>" to "<em>${step.to}</em>"<br>
          &nbsp;&nbsp;&nbsp;&nbsp;Depart: <strong>${to12Hour(step.departTime)}</strong>, Arrive: <strong>${to12Hour(step.arriveTime)}</strong><br><br>`;
        }
      }else{
        if(step.route != current_line){
          output.innerHTML += `
          ${j}. Take <strong>${current_line}</strong> from "<em>${last_stop}</em>" to "<em>${upcoming_stop}</em>"<br>
          &nbsp;&nbsp;&nbsp;&nbsp;Depart: <strong>${to12Hour(lastDepartTime)}</strong>, Arrive: <strong>${to12Hour(lastArriveTime)}</strong><br><br>`;
          j++;
          current_line = step.route;
          last_stop = step.from;
          upcoming_stop = step.to;
          lastDepartTime = step.departTime;
          lastArriveTime = step.arriveTime;
          if(i + 1 == path.length){
            output.innerHTML += `
          ${j}. Take <strong>${step.route}</strong> from "<em>${step.from}</em>" to "<em>${step.to}</em>"<br>
          &nbsp;&nbsp;&nbsp;&nbsp;Depart: <strong>${to12Hour(step.departTime)}</strong>, Arrive: <strong>${to12Hour(step.arriveTime)}</strong><br><br>`;
          }
        }
        else{
          upcoming_stop = step.to;
          lastArriveTime = step.arriveTime;
          if(i + 1 == path.length){
            output.innerHTML += `
            ${j}. Take <strong>${current_line}</strong> from "<em>${last_stop}</em>" to "<em>${upcoming_stop}</em>"<br>
            &nbsp;&nbsp;&nbsp;&nbsp;Depart: <strong>${to12Hour(lastDepartTime)}</strong>, Arrive: <strong>${to12Hour(step.arriveTime)}</strong><br><br>`;
          }
        }
      }
    })
  }
}
    



// ------------------- Autocomplete Setup -------------------


function setupAutocomplete(inputId, dropdownId) {
//  console.log("ran")
//  console.log(graph)
  const input = document.getElementById(inputId);
  const dropdown = document.getElementById(dropdownId);

  const stopNames = Array.from(new Set([
  ...Object.keys(graph.weekday),
  ...Object.keys(graph.weekend)
])).sort();

  input.addEventListener("input", () => {
    const value = input.value.trim().toLowerCase();
    dropdown.innerHTML = "";

    if (!value) {
      dropdown.style.display = "none";
      return;
    }

    const matches = stopNames.filter(stop =>
      stop.toLowerCase().includes(value)
    ).slice(0, 10);

    if (matches.length === 0) {
      dropdown.style.display = "none";
      return;
    }

    matches.forEach(match => {
      const item = document.createElement("div");
      item.className = "autocomplete-item";
      item.textContent = match;
      item.onclick = () => {
        input.value = match;
        dropdown.innerHTML = "";
        dropdown.style.display = "none";
      };
      dropdown.appendChild(item);
    });

    dropdown.style.display = "block";
  });

  // Close dropdown if clicking outside
  document.addEventListener("click", e => {
    if (!dropdown.contains(e.target) && e.target !== input) {
      dropdown.innerHTML = "";
      dropdown.style.display = "none";
    }
  });
}

function selectAll(){
const checkboxes = document.querySelectorAll('input[name="route_name"]');
  checkboxes.forEach(cb => cb.checked = true);
}

function deselectAll(){
const checkboxes = document.querySelectorAll('input[name="route_name"]');
  checkboxes.forEach(cb => cb.checked = false);
}


function summerRoutes(){
  const checkboxes = document.querySelectorAll('input[name="route_name"]');
    checkboxes.forEach(cb => {
    const route_list = ["Bobcat Express", "C-1", "C-2", "FastCat", "G-Line", "Route UC (North Loop)", "Route UC (South Loop)"];
    if(route_list.includes(cb.value)){
      cb.checked = true;
    }else{
      cb.checked = false;
    }
  });
}

window.onload = () => {
  const checkboxes = document.querySelectorAll('input[name="route_name"]');
  checkboxes.forEach(cb => cb.checked = true);
  setupAutocomplete("start", "start-autocomplete");
  setupAutocomplete("end", "end-autocomplete");
    clampInputValue("hour", 1, 12);   // Clamp to 1–12
    clampInputValue("minute", 0, 59); // Clamp to 0–59
};



</script>
